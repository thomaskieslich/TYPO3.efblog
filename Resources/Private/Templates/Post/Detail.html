{namespace tk=ThomasKieslich\Efblog\ViewHelpers}
<f:layout name="Default"/>
<f:section name="content">
	<f:flashMessages renderMode="div"/>
	<f:if condition="{post}">
		<f:render partial="Post/DetailMeta" arguments="{post: post, description: description}"/>

		<div class="tx-efblog-detail-container">
			<f:if condition="{settings.detailView.showBreadCrumb}">
				<f:render partial="Post/DetailBreadCrumb" arguments="{breadCrumb: breadCrumb}"/>
			</f:if>

			<f:render partial="Post/DetailBody" arguments="{_all}"/>


			<!--Social-->
			<f:if condition="{settings.detailView.showSocial}">
				<f:render partial="DetailSocial" arguments="{post: post, description : description, dam : dam}"/>
			</f:if>

			<div id="tx-efblog-detail-footer">
				<div class="more">
					<f:if condition="{post.teaserLink.link}">
						{f:if(condition: '{post.teaserLink.target}', then:
						"{post.teaserLinkTitle -> f:link.page(pageUid : '{post.teaserLink.link}', target: '{post.teaserLink.target}')}",
						else: "{post.teaserLinkTitle -> f:link.page(pageUid : '{post.teaserLink.link}')}")}
					</f:if>
				</div>

				<div class="info">
					{post.views} {f:translate(key : 'detail_views')} |
					{post.date -> f:format.date(format:'%d. %B %Y')} |
					<f:for each="{post.categories}" as="category" iteration="catIterator">
						<f:if condition="{catIterator.isLast}">
							<f:then>
								<f:link.action action="categoryList" pageUid="{settings.categoryUid}" additionalParams="{tx_efblog_fe1:{category : category}}" title="{category.title}">
									{category.title}
								</f:link.action>
							</f:then>
							<f:else>
								<f:link.action action="categoryList" pageUid="{settings.categoryUid}" additionalParams="{tx_efblog_fe1:{category : category}}" title="{category.title}">
									{category.title},
								</f:link.action>
							</f:else>
						</f:if>
					</f:for>
				</div>
			</div>

			<f:if condition="{post.relatedPosts}">
				<div id="tx-efblog-detail-relatedPost">
					<h3>{f:translate(key : 'detail_related_post')}</h3>
					<ul>
						<f:for each="{post.relatedPosts}" as="relatedPost">
							<li>
								<f:link.action action="detail" additionalParams="{tx_efblog_fe1:{post:relatedPost.uid}}" title="{relatedPost.title}">
									{relatedPost.title}<br>
								</f:link.action>
							</li>
						</f:for>
					</ul>
				</div>
			</f:if>
	</f:if>


	<f:if condition="{post.comments}">
		<a name="comments">&nbsp;</a>
		<f:if condition="{post.comments -> f:count()} > 1">
			<f:then>
				<h3>{post.comments -> f:count()} {f:translate(key : 'comments_comments')}</h3>
			</f:then>
			<f:else>
				<h3>{post.comments -> f:count()} {f:translate(key : 'comments_comment')}</h3>
			</f:else>
		</f:if>
		<p class="tx-efblog-comments-rss">
			{f:translate(key : 'comments_rss') -> f:link.action(action : 'detail', arguments : '{post:post}',
			pageUid : '{settings.detailUid}', pageType : '101')} </p>

		<div class="tx-efblog-comments-list">
			<f:for each="{comments}" as="comment" iteration="comIterator">
				<f:cycle as="row" values="{0: 'odd', 1: 'even'}">
					<div class="item {row}" id="comment_{comment.uid}">
						<f:render partial="CommentElement" arguments="{comment : comment, comIterator : comIterator, isMainComment : 1 post : post}"/>
						<f:for each="{comment.children}" as="child">
							<div style="margin-left: 50px">
								<f:render partial="CommentElement" arguments="{comment: child, comIterator:comIterator, post : post}"/>
							</div>
						</f:for>
					</div>
				</f:cycle>
			</f:for>
		</div>
	</f:if>

	<f:if condition='{allowComments}'>
		<div class="addComment">
			<h3>{f:translate(key : 'comments_add')}</h3><a name="comments_form">&nbsp;</a>
			<f:render partial='CommentForm' arguments="{object: newComment, objectName: 'newComment', post: post, newComment : newComment}"/>
		</div>
	</f:if>
</f:section>